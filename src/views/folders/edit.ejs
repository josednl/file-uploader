<%# Helper function to generate folder path/indentation (Requires 'level' or 'pathName' on folder objects) %>
<%
  // NOTE: This helper assumes your 'folders' array contains folder objects 
  // with a property like 'level' or 'pathName' to indicate hierarchy.
  const getFolderLabel = (f) => {
    // If you have a 'pathName' (e.g., 'Root / Docs / ProjectX'), use that:
    if (f.pathName) {
      return f.pathName;
    }
    
    // If you have a 'level' for indentation:
    const indent = f.level ? '‚Äî'.repeat(f.level) : '';
    return `${indent} ${f.name}`;
  }

  // Determine return URL based on parentId
  const returnUrl = folder.parentId ? `/folders/${folder.parentId}` : '/folders';
%>

<%- include('../partials/header', { title: 'Edit Folder' }) %>

<main class="max-w-xl mx-auto py-12 px-6">
  
  <div class="bg-white p-8 rounded-xl shadow-2xl border border-gray-100">
    
    <header class="mb-8 border-b pb-4">
      <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-yellow-500" viewBox="0 0 20 20" fill="currentColor">
          <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-5.606 5.606a2 2 0 110 2.828h-3a1 1 0 000 2h.586l3.914 3.914A2 2 0 0118 18.586V10c0-1.286-.51-2.5-1.464-3.464l-1.558-1.558-.934.933 2.583 2.583a1 1 0 010 1.414z" />
          <path d="M15 10a1 1 0 011-1h1a1 1 0 110 2h-1a1 1 0 01-1-1z" />
          <path fill-rule="evenodd" d="M3 17V3h6v4h4v10a2 2 0 01-2 2H5a2 2 0 01-2-2zM7 7h2v2H7V7z" clip-rule="evenodd" />
        </svg>
        Edit Folder: <span class="text-blue-600"><%= folder.name %></span>
      </h1>
      <p class="text-gray-500 text-sm mt-1">Modify the name and location of this folder.</p>
    </header>

    <form action="/folders/edit/<%= folder.id %>" method="POST" class="space-y-6">
      <div>
        <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">Folder Name</label>
        <input type="text" id="name" name="name" value="<%= folder.name %>" required
               class="mt-1 block w-full p-3 rounded-lg border-2 border-gray-300 shadow-sm
                      focus:outline-none focus:ring-blue-500 focus:border-blue-500 transition" />
      </div>

      <div>
        <label for="parentId" class="block text-sm font-semibold text-gray-700 mb-2">Move To / Parent Folder</label>
        <select id="parentId" name="parentId"
                class="mt-1 block w-full p-3 rounded-lg border-2 border-gray-300 shadow-sm
                       focus:outline-none focus:ring-blue-500 focus:border-blue-500 transition">
          <option value="" <%= !folder.parentId ? 'selected' : '' %>>
            üìÅ Root (No Parent)
          </option>
          <% folders.forEach(f => { %>
            <%
              // Prevent selecting the folder itself or any of its children as parent (not shown here, but a backend/frontend concern)
              const isCurrentFolder = f.id === folder.id; 
              const isDisabled = isCurrentFolder; // Simplified: only disable the current folder itself
            %>
            <option value="<%= f.id %>" 
                    <%= folder.parentId === f.id ? 'selected' : '' %>
                    <%= isDisabled ? 'disabled' : '' %>
                    title="<%= isDisabled ? 'Cannot select the folder itself' : '' %>">
              <%= getFolderLabel(f) %>
              <%= folder.parentId === f.id ? ' (Current)' : '' %>
            </option>
          <% }) %>
        </select>
        <p class="text-xs text-gray-500 mt-2">Selecting a new parent will move this folder.</p>
      </div>

      <div class="pt-4">
        <button type="submit"
                class="w-full inline-flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
          </svg>
          Update Folder
        </button>
      </div>
    </form>
    
    ---

    <section class="mt-8 border-t pt-6">
      <h2 class="text-xl font-bold text-gray-900 mb-3">Delete Folder</h2>
      <div class="p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded">
        <p class="font-medium">‚ö†Ô∏è Warning:</p>
        <p class="text-sm mt-1">Deleting this folder **will permanently delete all its contents** (files and subfolders). This action cannot be undone.</p>
      </div>

      <form action="/folders/delete/<%= folder.id %>" method="POST" onsubmit="return confirm('WARNING: This will permanently delete the folder and ALL its contents. Are you absolutely sure?')" class="mt-4">
        <button type="submit"
                class="w-full inline-flex items-center justify-center gap-2 px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition shadow focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4m-4 0a1 1 0 00-1 1v1h6V4a1 1 0 00-1-1m-4 0h4" />
          </svg>
          Delete Folder Permanently
        </button>
      </form>
    </section>

    <div class="mt-8 pt-6 border-t">
      <a href="<%= returnUrl %>" class="text-blue-600 hover:text-blue-800 font-medium text-sm inline-flex items-center gap-1.5 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to Folder View
      </a>
    </div>
  </div>
</main>

<%- include('../partials/footer') %>
