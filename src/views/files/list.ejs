<%
  const formatBytes = (bytes, decimals = 2) => {
    if (bytes === 0) return '0 Bytes';

    const k = 1024;
    const dm = decimals < 0 ? 0 : decimals;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];

    const i = Math.floor(Math.log(bytes) / Math.log(k));

    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
  }
  const returnUrl = typeof from !== 'undefined' ? from : '/files';
%>

<%- include('../partials/header', { title: 'Your Files' }) %>

<main class="max-w-6xl mx-auto px-6 py-12">

  <header class="mb-10">
    <h1 class="text-4xl font-extrabold text-gray-900 tracking-tight flex items-center gap-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0013.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
      </svg>
      Your Files
    </h1>
    <p class="text-gray-500 mt-1">A comprehensive list of all files uploaded to the platform.</p>
  </header>

  <section class="mb-12 bg-white border border-gray-200 rounded-xl p-6 shadow-lg">
    <h2 class="text-xl font-bold text-gray-900 mb-4">Upload a New File</h2>
    <form action="/files/upload" method="POST" enctype="multipart/form-data" class="flex flex-col md:flex-row md:items-center gap-4">
      <label class="block w-full md:flex-grow">
        <span class="sr-only">Choose file to upload</span>
        <input type="file" name="file" required
          class="block w-full text-sm text-gray-500
            file:mr-4 file:py-2 file:px-4
            file:rounded-full file:border-0
            file:text-sm file:font-semibold
            file:bg-blue-50 file:text-blue-700
            hover:file:bg-blue-100 transition
            cursor-pointer
          "
        />
      </label>
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg shadow font-semibold transition w-full md:w-auto focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
        Upload
      </button>
    </form>
  </section>

  <section>
    <h2 class="text-2xl font-bold mb-4 text-gray-900">All Uploaded Files (<%= files.length %>)</h2>

    <% if (files.length === 0) { %>
      <p class="text-gray-500 italic p-4 border rounded-lg bg-white">No files have been uploaded yet.</p>
    <% } else { %>
      <div class="overflow-x-auto bg-white rounded-xl shadow-lg border border-gray-100">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">File Name</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Size</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <% files.forEach(file => { %>
              <tr class="hover:bg-gray-50 transition">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 max-w-xs truncate">
                  <a href="/files/details/<%= file.id %>?from=<%= returnUrl %>" class="hover:text-blue-600">
                    <%= file.name %>
                  </a>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  <%= formatBytes(file.size) %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  <% if (file.folder) { %>
                    <a href="/folders/<%= file.folder.id %>" class="text-blue-500 hover:text-blue-700 hover:underline">
                      <%= file.folder.name %>
                    </a>
                  <% } else { %>
                    Root
                  <% } %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <div class="flex justify-end gap-3">
                    <a href="/files/details/<%= file.id %>?from=<%= returnUrl %>" class="text-blue-600 hover:text-blue-800 font-medium">
                      Details
                    </a>
                    <a href="/files/download/<%= file.id %>" class="text-green-600 hover:text-green-800 font-medium">
                      Download
                    </a>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </section>

</main>

<%- include('../partials/footer') %>
