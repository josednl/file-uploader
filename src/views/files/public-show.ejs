<%
  const formatBytes = (bytes, decimals = 2) => {
    if (bytes === 0) return '0 Bytes';

    const k = 1024;
    const dm = decimals < 0 ? 0 : decimals;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];

    const i = Math.floor(Math.log(bytes) / Math.log(k));

    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
  }
  const fileNameParts = file.name.split('.');
  const fileExtension = fileNameParts.length > 1 ? fileNameParts.pop().toUpperCase() : 'FILE';
%>

<%- include('../partials/header', { title: file.name }) %>

<main class="max-w-4xl mx-auto py-12 px-6">
  <div class="bg-white p-8 sm:p-10 rounded-xl shadow-2xl border border-gray-100 space-y-8">

    <header class="border-b pb-4 mb-4">
      <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0013.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
        <%= file.name %>
      </h1>
      <p class="text-gray-500 text-sm mt-2">Shared publicly via a secure link.</p>
    </header>

    <section class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">File Preview</h2>
      
      <% if (file.mimeType.startsWith('image/')) { %>
        <div class="max-h-[50vh] overflow-hidden rounded-lg shadow-lg border border-gray-300">
          <img src="/shared/public/<%= sharedToken %>/download/<%= file.id %>" alt="<%= file.name %> preview" class="max-w-full h-auto mx-auto object-contain">
        </div>
        <p class="text-sm text-gray-500 mt-3">Click 'Download' for full resolution.</p>

      <% } else if (file.mimeType.startsWith('video/')) { %>
        <div class="h-48 flex items-center justify-center bg-gray-200 rounded-lg text-gray-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
          Video file. Download required to view.
        </div>
      <% } else { %>
        <div class="py-12 flex flex-col items-center justify-center space-y-2">
          <div class="w-16 h-20 bg-white border-4 border-blue-200 rounded-lg flex items-center justify-center relative">
            <span class="text-xs font-bold text-gray-600 absolute bottom-1"><%= fileExtension %></span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-3-3v6m-4-7h8a2 2 0 012 2v10a2 2 0 01-2 2H9a2 2 0 01-2-2V7a2 2 0 012-2z" />
            </svg>
          </div>
          <p class="text-gray-600 font-medium mt-4">No inline preview available.</p>
        </div>
      <% } %>
    </section>

    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-4">
      
      <div class="col-span-1">
        <h3 class="text-lg font-semibold text-gray-800 mb-2 border-b pb-1">Details</h3>
        <ul class="text-sm text-gray-600 space-y-1">
          <li><strong>Type:</strong> <%= file.mimeType %></li>
          <li><strong>Size:</strong> <%= formatBytes(file.size) %></li>
          <li><strong>Uploaded:</strong> <%= file.createdAt.toLocaleString() %></li>
        </ul>
      </div>

      <div class="md:col-span-2 flex flex-col justify-end space-y-3">
        <a href="/shared/public/<%= sharedToken %>/download/<%= file.id %>" 
           class="w-full inline-flex items-center justify-center px-6 py-3 bg-green-600 text-white text-lg font-semibold rounded-lg shadow-lg hover:bg-green-700 transition focus:outline-none focus:ring-4 focus:ring-green-300 gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
          Download File
        </a>
      </div>
    </section>
    
    <div class="mt-8 pt-4 border-t">
      <a href="/shared/public/<%= sharedToken %>" class="text-blue-600 hover:text-blue-800 font-medium text-sm inline-flex items-center gap-1.5 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to Shared Folder
      </a>
    </div>

  </div>
</main>

<%- include('../partials/footer') %>
