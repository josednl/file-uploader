<%# Helper function to format file size in a human-readable way (e.g., 1.5 MB) %>
<%
  const formatBytes = (bytes, decimals = 2) => {
    if (bytes === 0) return '0 Bytes';

    const k = 1024;
    const dm = decimals < 0 ? 0 : decimals;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];

    const i = Math.floor(Math.log(bytes) / Math.log(k));

    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
  }

  const returnUrl = typeof from !== 'undefined' ? from : '/files';

  // Simple check for file type for a basic preview
  const isImage = file.mimeType.startsWith('image/');
  const isText = file.mimeType.startsWith('text/') || ['application/json', 'application/xml'].includes(file.mimeType);
%>

<%- include('../partials/header', { title: 'File Details' }) %>

<main class="max-w-4xl mx-auto px-6 py-12">

  <div class="mb-8">
    <a href="<%= returnUrl %>" class="text-blue-600 hover:text-blue-800 font-medium inline-flex items-center gap-1.5 transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      Go Back
    </a>
  </div>

  <div class="bg-white p-8 lg:p-10 rounded-xl shadow-xl border border-gray-100">
    <header class="mb-8 border-b pb-4">
      <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight mb-1">
        <%= file.name %>
      </h1>
      <p class="text-gray-500 text-sm">File Details and Actions</p>
    </header>

    <% if (isImage) { %>
    <section class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200 text-center">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Image Preview</h2>
      <img src="/files/download/<%= file.id %>" alt="File Preview: <%= file.name %>" class="max-w-full h-auto max-h-96 mx-auto rounded-lg shadow-lg object-contain border border-gray-300">
    </section>
    <% } else if (isText) { %>
    <section class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">File Type</h2>
      <p class="text-gray-600 italic">No detailed preview available, but you can <a href="/files/download/<%= file.id %>" class="text-blue-600 hover:underline">download the file</a> to view the content.</p>
    </section>
    <% } %>

    <section class="mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Metadata</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 bg-gray-50 rounded-lg p-6 border border-gray-200">

        <div class="flex flex-col">
          <strong class="text-xs font-semibold uppercase text-gray-500">File Name</strong>
          <span class="text-gray-800 font-medium break-all"><%= file.name %></span>
        </div>

        <div class="flex flex-col">
          <strong class="text-xs font-semibold uppercase text-gray-500">MIME Type</strong>
          <span class="text-gray-800 font-medium"><%= file.mimeType %></span>
        </div>

        <div class="flex flex-col">
          <strong class="text-xs font-semibold uppercase text-gray-500">Size</strong>
          <span class="text-gray-800 font-medium"><%= formatBytes(file.size) %></span>
        </div>

        <div class="flex flex-col">
          <strong class="text-xs font-semibold uppercase text-gray-500">Uploaded On</strong>
          <span class="text-gray-800 font-medium">
            <%= file.createdAt.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' }) %>
          </span>
        </div>

        <div class="flex flex-col">
          <strong class="text-xs font-semibold uppercase text-gray-500">Location</strong>
          <% if (file.folder) { %>
            <a href="/folders/<%= file.folder.id %>" class="text-blue-600 hover:underline font-medium">
              <%= file.folder.name %>
            </a>
          <% } else { %>
            <span class="text-gray-500 italic font-medium">Root Directory</span>
          <% } %>
        </div>

        <div class="flex flex-col">
          <strong class="text-xs font-semibold uppercase text-gray-500">File ID</strong>
          <span class="text-gray-800 text-sm font-mono break-all"><%= file.id %></span>
        </div>

      </div>
    </section>

    <section class="pt-6 border-t">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Actions</h2>
      <div class="flex flex-wrap gap-4">
        
        <a href="/files/download/<%= file.id %>" class="inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-blue-700 transition shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
          Download File
        </a>

        <a href="/files/move/<%= file.id %>" class="inline-flex items-center justify-center gap-2 bg-yellow-500 text-white px-5 py-2 rounded-lg font-semibold hover:bg-yellow-600 transition shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4" />
          </svg>
          Move to Folder
        </a>

        <form action="/files/delete/<%= file.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this file? This action is permanent.')" class="inline">
          <button type="submit" class="inline-flex items-center justify-center gap-2 bg-red-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-red-700 transition shadow-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4m-4 0a1 1 0 00-1 1v1h6V4a1 1 0 00-1-1m-4 0h4" />
            </svg>
            Delete File
          </button>
        </form>
      </div>
    </section>

  </div>
</main>

<%- include('../partials/footer') %>
